<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
     <!-- ì œì´ì¿¼ë¦¬ ì„í¬íŠ¸ --> 
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <title>hangHaeLog-register</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
          crossorigin="anonymous"></script>
          <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Serif+KR:wght@500&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Serif+KR:wght@500&family=Sunflower:wght@500&display=swap"
          rel="stylesheet">      

    <style>

    body {
        background-color: ivory;
    }
    .basic {
            position: relative;
            font-family: 'Black Han Sans', sans-serif;
            font-size: 120px;
            margin-left: 100px;
            letter-spacing: 10px;
            line-height: 20px;
            margin-bottom: 10px;
        }
    .wrap {
            width: 600px;
            height: 540px;
            margin: auto;
            margin-right: 250px;
            margin-top: 190px;
            padding-top: 50px;
            padding-left: 200px;
            }
    .wrap label{
        width:100px;
    }
        .you {
            position: absolute;top: 60px;left: 0;
            color: gold;
        }
        .are {
            position: absolute;top: 190px;left: 0;
            color: gold;
        }
        .my {
            position: absolute;top: 320px;left: 0;
            color: mediumpurple;
        }
        .favorite {
            position: absolute;top: 450px;left: 0;
            color: navy;
        }
        .mybutton {
            display: flex;
        }
        .fst {
            margin-top: 20px;
            margin-left: 110px;
            margin-right: 30px;
        }
        .scd {
            margin-top: 20px;
        }
        .id {
            margin-bottom: 10px;
        }
        .twoButton{
            width: 400px;
            display: flex;
        }
        .back{
            margin-right: 100px;
            margin-left: 50px;
        }

    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script>

        /*hasClass('í´ë˜ìŠ¤ ì´ë¦„'):ì„ íƒí•œ ìš”ì†Œì— í´ë˜ìŠ¤ê°€ ìˆëŠ”ì§€ í™•ì¸í•¨*/
        $(document).ready(function () {
            $('.m_pass button').on('click', function () {
                $('input').toggleClass('active');
                /*ë§Œì•½ input íƒœê·¸ì— activeê°€ ì¶”ê°€ëœë‹¤ë©´*/
                if ($('input').hasClass('active')) {
                    $('.show').css({backgroundColor: '#ffcc00'})
                        .prev('input').attr('type', 'text');

                } else {
                    $('.show').css({backgroundColor: '#fff'})
                        .prev('input').attr('type', 'password');
                }

            });
        });


        function mid(asValue) {
            var regExp = /^(?=.*[a-zA-Z0-9])[-a-zA-Z0-9]{3,}$/i;
            
  
            return regExp.test(asValue);
        }

        function mpw(asValue) {
            var regExp = /^(?=.*\d)(?=.*[a-zA-Z0-9])[0-9a-zA-Z]{4,}$/i;
            return regExp.test(asValue);
        }

        function check_id() {
            let userid = $(".input-userid").val()
            console.log(userid)

            if (userid == "") {
                $("#help_id").text("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.").removeClass("is-success").addClass("is-danger")
                $(".input-userid").focus()
                return;
            }

            if (!mid(userid)) {
                $("#help_id").text("ë‹‰ë„¤ì„ì€ ìµœì†Œ 3ì ì´ìƒ, ì•ŒíŒŒë²³ ëŒ€ì†Œë¬¸ì, ìˆ«ìë¡œ êµ¬ì„±").removeClass("is-success").addClass("is-danger")
                $("#input-userid").focus()
                return;
            }

            $("#help_id").addClass("is-loading")
            let nickname = userid
            $.ajax({
                type: "POST",
                url: "/check_id",
                contentType:"application/json",
                data:JSON.stringify({nickname: nickname}),
                success: function (response) {
                    console.log("ë‹‰ë„¤ì„ ì „ì†¡ ì™„ë£Œ")

                   if (response["exists"]) {
                        $("#help_id").text("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.").removeClass("is-success").addClass("is-danger")
                        $(".input-userid").focus()
                    } else {
                        $("#help_id").text("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.").removeClass("is-danger").addClass("is-success")
                    }
                    $("#help_id").removeClass("is-loading")

                }
            })
        }

        function register() {
            let username = $('.input-username').val()
            let userid = $(".input-userid").val()
            let userpassword = $(".input_pw").val()
            let userpassword_scd = $(".input_pw_scd").val()

            if(username==""){
                $("#help_name").text("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.").removeClass("is-success").addClass("is-danger")
                $(".input-username").focus()
                return;
            }
            if (userid == ""){
                $("#help_id").text("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.").removeClass("is-safe").addClass("is-danger")
                $(".input-userid").focus()
                return;
            } else if ($("#help_id").hasClass("is-danger")) {
                alert("ë‹‰ë„¤ì„ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.")
                return;
            } else if (!$("#help_id").hasClass("is-success")) {
                alert("ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”.")
                return;
            }

            if (userpassword == "") {
                $("#help_password_fst").text("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”").removeClass("is-success").addClass("is-danger")
                $(".input_pw").focus()
                return;
            } else if (!mpw(userpassword)||userpassword.includes(userid)) {
                $("#help_password_fst").text("ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ì— ë‹‰ë„¤ì„ê³¼ ê°™ì€ ê°’ì´ í¬í•¨ëœ ê²½ìš° ì‚¬ìš©ë¶ˆê°€").removeClass("is-success").addClass("is-danger")
                $("#input_pw").focus()
                return;
            } else {
                $("#help_password_fst").text("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.").removeClass("is-danger").addClass("is-success")
            }
            if (userpassword_scd == "") {
                $("#help_password_scd").text("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.").removeClass("is-success").addClass("is-danger")
                $("#input_pw_scd").focus()
                return;
            } else if (userpassword_scd != userpassword) {
                $("#help_password_scd").text("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.").removeClass("is-success").addClass("is-danger")
                $("#input_pw_scd").focus()
                return;
            } else {
                $("#help_password_scd").text("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.").removeClass("is-danger").addClass("is-success")
            }

            $.ajax({
                type: "POST",
                url: "/usersave",
                data: {
                    name: $('#mname').val(),
                    nickname: $('#mid').val(),
                    password: $('#mpw').val(),

                },
                success: function (response) {

                    console.log("ë°ì´í„° ì „ì†¡ ì™„ë£Œ")
                    if (response['result'] == 'success') {
                        alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')
                        window.location.href = '/login'
                    } else {
                        alert(response['msg'])
                    }
                }
            })
        }

        function login_back(){
            window.location.href = '/login'
        }

    </script>


</head>
<body>
        <div class="basic">
    <p class="you">hang</p>
    <p class="are">Hae</p>
    <p class="my">Log</P>
</div>

<div class="wrap">
    <h1>íšŒì›ê°€ì…</h1>

    <!--ì´ë¦„-->
    <div class="name">
        <label for="mname">ì´ë¦„</label>
        <input type="text" id="mname" class="input input-username">
        <p id="help_name" class="help"></p>
    </div>

    <!--ì•„ì´ë””-->
    <div class="m_id">
        <label for="mid">ë‹‰ë„¤ì„</label>
        <input class="input input-userid" type="text" id="mid">
        <button type="button" class="btn btn-warning" onclick="check_id()">ì¤‘ë³µí™•ì¸</button>
    </div>
    <!--ì¡°ê±´ì— ì¶©ì¡±í•˜ì§€ ì•Šì„ ê²½ìš° ë¬¸êµ¬ ë„ìš°ê¸°-->
    <p id="help_id" class="help is-success"></p>


    <!--ë¹„ë°€ë²ˆí˜¸-->
    <div class="m_pass">
        <label for="mpw">ì•”í˜¸</label>
        <input type="password" id="mpw" class="input input_pw">
        <button class='show'>ğŸ‘€</button>
    </div>
    <p id="help_password_fst" class="help is-success"></p>

    <!--ë¹„ë°€ë²ˆí˜¸ í™•ì¸-->
    <div class="m_pass2">
        <label for="mpw2">ì•”í˜¸ í™•ì¸</label>
        <input type="password" id="mpw2" class="input input_pw_scd">

        <!--ì¼ì¹˜í• ê²½ìš° píƒœê·¸ì•ˆì— ë¬¸êµ¬ ë„ìš°ê¸°-->

        <p id="help_password_scd" class="help is-success"></p>
    </div>
    <div class="twoButton">
    <div class="back">
        <button type="button" class="btn btn-secondary" onclick="login_back()">ëŒì•„ê°€ê¸°</button>
    </div>
    <div class="confirm">
        <button type="button" class="btn btn-warning" onclick="register()">ê°€ì…í•˜ê¸°</button>
    </div>
</div>
</div>
</div>
</body>
</html>